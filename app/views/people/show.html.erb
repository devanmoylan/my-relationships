<%= link_to '< People', user_people_path(@user) %>
<div class="jumbotron">
  <div class="row">
    <div class="col-3">
      <%= image_tag url_for(avatar(@person, 200)), class: 'rounded' %>
    </div>
    <div class="col-9">
      <h1>Person</h1>
      <p>
        <strong>First name:</strong>
        <%= @person.first_name %>
      </p>

      <p>
        <strong>Last name:</strong>
        <%= @person.last_name %>
      </p>

      <p>
        <strong>Birthday:</strong>
        <%= @person.birthday %> <%= "(age: ~#{ age_helper(@person.birthday) })" if @person.birthday? %>
      </p>

      <p>
        <strong>Email:</strong>
        <%= @person.email %>
      </p>

      <p>
        <strong>Position:</strong>
        <%= @person.position %>
      </p>

      <p>
        <strong>Company:</strong>
        <%= @person.company %>
      </p>

      <p>
        <strong>Notes:</strong>
        <%= @person.notes %>
      </p>

      <%= link_to 'Edit', edit_user_person_path(@user, @person) %>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-8">
    <h2>Activity</h2>
    <%= link_to 'New Interaction', new_user_person_interaction_path(@user, @person) %>

    <br>
    <br>
    <% activity =  @person.interactions + @person.mentions %>
    <% activity.sort_by(&:created_at).each do |object| %>
      <%= render partial: "#{object.class.name.downcase}", locals: { object.class.name.downcase.to_sym => object, person: @person, user: @user } %>
    <% end %>
  </div>

  <div class="col-4">

    <h2>Mentions</h2>

    <br>
    <br>

    <% @person.mentions.order(created_at: :desc).each do |object| %>
      <%= render partial: "#{object.class.name.downcase}", locals: { object.class.name.downcase.to_sym => object, person: @person, user: @user } %>
    <% end %>

    <h2>Bonds</h2>

    <%= link_to 'New Bond', new_user_person_bond_path(@user, @person) %>

    <br>
    <br>

    <div class="card">
      <div class="card-body">
        <table>
          <tbody>
          <% @person.bonds.each do |bond| %>
            <tr>
              <td><%= bond.first_name %> <%= bond.last_name %><br><%= "age: #{ age_helper(bond.birthday)}" if bond.birthday %></td>
              <td><%= bond.relationship %></td>
              <td><%= link_to 'Edit', edit_user_person_bond_path(@user, @person, bond) %> <%= link_to 'Destroy', user_person_bond_path(@user, @person, bond), method: :delete, data: {confirm: 'Are you sure?'} %></td>
            </tr>
          <tr>
            <td><%= bond.notes %></td>
          </tr>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>

    <br>


    <h2>Experiences</h2>
    <%= link_to 'New Experience', new_user_person_experience_path(@user, @person) %>

    <br>
    <br>

    <div class="card">
      <div class="card-body">
        <% @person.experiences.order(end_date: :desc).each do |experience| %>
          <h5 class="card-title"><%= experience.role %></h5>
          <h6 class="card-subtitle mb-2 text-muted"><%= "#{experience.start_date.strftime("%B %Y")} - #{experience.current? ? 'current' : experience.end_date.strftime("%B %Y")}" %></h6>
          <hr>
          <table>
            <tbody>
            <tr>
              <td>Type:</td>
              <td><%= experience.experience_type %></td>
            </tr>
            <tr>
              <td>Location:</td>
              <td><%= experience.location %></td>
            </tr>
            <tr>
              <td>Details:</td>
              <td><%= experience.description %></td>
            </tr>
            </tbody>
          </table>
          <br>
          <%= link_to 'Edit', edit_user_person_experience_path(@user, @person, experience) %> |
          <%= link_to 'Destroy', user_person_experience_path(@user, @person, experience), method: :delete, data: {confirm: 'Are you sure?'} %>
          <hr>
        <% end %>
      </div>
    </div>

    <h2>Events</h2>

    <table>
      <thead>
      <tr>
        <th>Date</th>
        <th>Duration</th>
        <th>Role</th>
        <th>Description</th>
        <th>Title</th>
        <th>Location</th>
        <th colspan="3"></th>
      </tr>
      </thead>

      <tbody>
      <% @person.events.order(date: :desc).each do |event| %>
        <tr>
          <td><%= event.date %></td>
          <td><%= event.duration %></td>
          <td><%= event.role %></td>
          <td><%= event.description %></td>
          <td><%= event.title %></td>
          <td><%= event.location %></td>
          <td><%= link_to 'Edit', edit_user_person_event_path(@user, @person, event) %></td>
          <td><%= link_to 'Destroy', user_person_event_path(@user, @person, event), method: :delete, data: {confirm: 'Are you sure?'} %></td>
        </tr>
      <% end %>
      </tbody>
    </table>

    <br>

    <%= link_to 'New Event', new_user_person_event_path(@user, @person) %>

    <h2>Interests</h2>

    <%= link_to 'New Interest', new_user_person_interest_path(@user, @person) %>

    <br>
    <br>

    <div class="card">
      <div class="card-body">
        <table>
          <tbody>
          <% @person.interests.each do |interest| %>
            <tr>
              <td><%= interest.name %></td>
              <td><%= interest.level %></td>
              <td><%= link_to 'Edit', edit_user_person_interest_path(@user, @person, interest) %></td>
              <td><%= link_to 'Destroy', user_person_interest_path(@user, @person, interest), method: :delete, data: {confirm: 'Are you sure?'} %></td>
            </tr>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>

    <br>

  </div>
</div>
